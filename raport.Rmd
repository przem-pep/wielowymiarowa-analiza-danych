---
title: "Analiza zbioru danych mieszkania"
subtitle: "Wielowymiarowa analiza danych"
author: "Przemysław Peplinski, Wiktor Galewski, Mikołaj Zalewski"
date: "`r Sys.Date()`"
output: pdf_document
toc: true
toc-title: "Spis treści"
fontsize: 12pt

header-includes:
  - \setcounter{secnumdepth}{2}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE)
```

```{r wczytanie pakietów, include=FALSE}
library(tidyverse)
library(readxl)
library(missForest)
```

```{r definiowanie funkcji, include=FALSE}


```

```{r wczytanie danych, include=FALSE}
dane <- read_excel("mieszkania.xlsx")
```

# Wstęp

## Autorzy

Autorami są... Wkład w projekt prezentował się następująco...

## Motywacja i cele

Coś tam...

## Opis projektu

Coś tam...

# Opis danych

Dane pochodzą.../Dane zostały zebrane...

```{r przegląd danych}
glimpse(dane)
```

Opisać zmienne...

Wśród zmiennych niepotrzebnych do analizy można wymienić link, tytuł, opis oraz numer telefonu. Zmienne te zostaną zatem usunięte.

# Czyszczenie danych

## Walidacja

Tak

```{r}
glimpse(dane)
```


```{r walidacja}
dane %>%
  summarise(across(everything(),
                   list(
                     min = function(x) min(x, na.rm = TRUE),
                     max = function (x) max(x, na.rm = TRUE)))) %>%
  pivot_longer(
    cols = everything(),
    names_to = c("variable", ".value"),
    names_sep = "_"
  )

```


## Obsługa braków wartości

Kilka zmiennych do usunięcia, dla niektórych trzeba usunąć obserwacje, w innych imputować wg obliczeń.

```{r czyszczenie danych}
# usuniecie duplikatow po linku
dane <- distinct(dane, Link, .keep_all = TRUE)

# usuniecie zbednych kolumn
dane <- dane %>%
  select(c(-Link, -Tytuł, -Opis, -`Numer telefonu`, -Ocena, -`Liczba pięter`))

# modyfikacja ogloszenia jako zmienna binarna
dane <- dane %>%
  mutate(`Data modyfikacji` = as.integer(!is.na(`Data modyfikacji`)))

# cena za metr - usuniecie bledow i NA
dane <- dane %>%
  filter(`Cena za metr` >= 1100 & `Cena za metr` <= 63000)

# powierzchnia - usuniecie bledow
dane <- dane %>%
  filter(Powierzchnia >= 14 & Powierzchnia <= 900)

# pietro - usuniecie bledow i NA
dane <- dane %>%
  filter(Piętro >= 0 & Piętro <= 20)

# liczba pokoi - poprawa i wymazanie bledow
dane <- dane %>%
  mutate(`Liczba pokoi` = case_when(
    `Liczba pokoi` %in% c(21, 23) ~ 2,
    `Liczba pokoi` >= 1 & `Liczba pokoi` <= 24 ~ `Liczba pokoi`,
    TRUE ~ NA_real_))

# ogloszeniodawca i rynek - usuniecie NA
dane <- dane %>%
  filter(!is.na(Ogłoszeniodawca) & !is.na(Rynek))

# rok budowy - wymazanie bledow
dane <- dane %>%
  mutate(`Rok budowy` = if_else(between(`Rok budowy`, 1780, 2028), 
                                `Rok budowy`, NA_real_))

# rodzaj budynku - pozostale jako NA
dane <- dane %>%
  mutate(`Rodzaj budynku` = na_if(`Rodzaj budynku`, "Pozostałe"))

# usuniecie obserwacji, gdzie zarowno rok budowy, jak i rodzaj budynku sa NA
dane <- dane %>%
  filter(!(is.na(`Rok budowy`) & is.na(`Rodzaj budynku`)))

# modyfikacja typow niektorych zmiennych
dane <- dane %>%
  mutate(`Data dodania` = as.numeric(as.Date(`Data dodania`))) %>%
  mutate(across(c(Dzielnica, `Rodzaj budynku`, Portal), as.factor)) %>%
  mutate(Rynek = as.integer(Rynek == "Pierwotny")) %>%
  mutate(Ogłoszeniodawca = as.integer(Ogłoszeniodawca == "Agencja"))

# imputacja brakow danych (liczba pokoi, rok budowy, rodzaj budynku)
imputacje <- missForest(as.data.frame(dane), verbose = TRUE)
dane <- imputacje$ximp
```

## Obsługa obserwacji odstających

Jako tako zostawiamy

# Analiza eksploracyjna

## Statystyki opisowe

```{r statystyki opisowe}
summary(dane)
```


## Analiza rozkładów

Histogramy zmiennych numerycznych, wykresy kolumnowe zmiennych kategorycznych

```{r histogramy}
ggplot(dane, aes(x = Piętro)) +
  geom_histogram(binwidth = 1) +
  theme_bw()

```

## Analiza korelacji

Macierz korelacji

## Analiza braków danych

Krótkie podsumowanie braków danych (wykres słupkowy?)

```{r zliczenie braków danych, fig.align='center', fig.width=6, fig.height=4}
braki_danych <- colSums(is.na(dane)) / nrow(dane)
ggplot(mapping = aes(x = names(braki_danych), y = braki_danych)) +
  geom_col(fill = "firebrick") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Udział braków danych wg zmiennej",
       x = NULL,
       y = NULL) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 90))

```

## Analiza obserwacji odstających

Zrobić boxploty

# Obróbka zmiennych

## Kodowanie zmiennych kategorycznych

## Normalizacja zmiennych numerycznych

# 2 metody

## Metoda 1

## Metoda 2

# Porównanie metod

Porównanie i wizualizacje

# Wnioski
